<div class="shortlisted-candidates-container">
  <header class="page-header">
    <h1>Shortlisted Candidates</h1>
  </header>

  <div class="search-filter-container">
    <input
      type="text"
      placeholder="Search jobs..."
      [(ngModel)]="filters.searchTerm"
      (input)="onSearchChange(filters.searchTerm)" 
      class="search-input"
    >
    <select [(ngModel)]="filters.jobType" (change)="loadJobs(1)" class="filter-select">
      <option value="">All Job Types</option>
      <option *ngFor="let option of jobTypeOptions" [value]="option.value">
        {{ option.label }}
      </option>
    </select>
  </div>

  <div *ngIf="(jobs$ | async)?.length" class="table-container">
    <table  class="jobs-table">
      <thead>
        <tr>
          <th>Job Title</th>
          <th>Candidate Name</th>
          <th>Email</th>
          <th>Experience</th>
          <th>Skills</th>
          <th>Expected Salary</th>
          <th>Applied Date</th>
          <th>Resume</th>
          <th>Action</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let job of (jobs$ | async)">
          <ng-container *ngFor="let applicant of job.applicants">
            <td data-label="Job Title">{{ job.jobTitle }}</td>
            <td data-label="Candidate Name">{{ applicant.userId.name }}</td>
            <td data-label="Email">{{ applicant.userId.email }}</td>
            <td data-label="Experience">{{ applicant.userId.professionalDetails?.experience || 'N/A' }} years</td>
            <td data-label="Skills">{{ applicant.userId.professionalDetails?.skills?.join(', ') || 'N/A' }}</td>
            <td data-label="Expected Salary">â‚¹{{ applicant.userId.professionalDetails?.expectedSalary | number }}</td>
            <td data-label="Applied Date">{{ applicant.appliedDate | date }}</td>
            <td>
              <a 
                [href]="applicant.userId.professionalDetails?.resumeUrl"
                target="_blank"
                class="resume-link"
              >
                View Resume
              </a>
            </td>
            <td>
              <button class="video-call-btn" (click)="openChat(applicant._id)">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M23 7l-7 5 7 5V7z"/>
                  <rect x="1" y="5" width="15" height="14" rx="2" ry="2"/>
                </svg>
               Message
              </button>
              
              <button class="video-call-btn" (click)="joinVideoCall(applicant)">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M23 7l-7 5 7 5V7z"/>
                  <rect x="1" y="5" width="15" height="14" rx="2" ry="2"/>
                </svg>
                Meet
              </button>
            </td>
          </ng-container>
        </tr>
      </tbody>
    </table>
  </div>

  <div *ngIf="!(jobs$ | async)?.length" class="no-jobs-message">
    <p>No shortlisted candidates found.</p>
  </div>

  <div *ngIf="totalJobs > pageSize" class="pagination-controls">
    <button (click)="changePage(currentPage - 1)" [disabled]="currentPage === 1">Previous</button>
    <span>Page {{ currentPage }} of {{ totalPages }}</span>
    <button (click)="changePage(currentPage + 1)" [disabled]="currentPage === totalPages">Next</button>
  </div>
</div>
